/**
 *  @license dcore.js
 *  Copyright Â© 2017 Valentin Lozev
 *  Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 *  Source code: http://github.com/valentin-lozev/dcore
 */
"function"!=typeof Object.assign&&(Object.assign=function(target,varArgs){"use strict";if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=1;index<arguments.length;index++){var nextSource=arguments[index];if(null!=nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to});var dcore;!function(dcore){var _private;!function(_private){function argumentGuard(errorMsgPrefix){return void 0===errorMsgPrefix&&(errorMsgPrefix=""),new ArgumentGuard(errorMsgPrefix)}var ArgumentGuard=function(){function ArgumentGuard(errorMsgPrefix){void 0===errorMsgPrefix&&(errorMsgPrefix=""),this.errorMsgPrefix=errorMsgPrefix}return ArgumentGuard.prototype.mustBeDefined=function(arg,msg){if("undefined"==typeof arg||null===arg)throw new Error(this.errorMsgPrefix+msg);return this},ArgumentGuard.prototype.mustBeUndefined=function(arg,msg){if("undefined"!=typeof arg&&null!==arg)throw new Error(this.errorMsgPrefix+msg);return this},ArgumentGuard.prototype.mustBeNonEmptyString=function(arg,msg){if("string"!=typeof arg||!arg.length)throw new Error(this.errorMsgPrefix+msg);return this},ArgumentGuard.prototype.mustBeFunction=function(arg,msg){if("function"!=typeof arg)throw new Error(this.errorMsgPrefix+msg);return this},ArgumentGuard.prototype.mustBeArray=function(arg,msg){if(!Array.isArray(arg))throw new Error(this.errorMsgPrefix+msg);return this},ArgumentGuard}();_private.argumentGuard=argumentGuard}(_private=dcore._private||(dcore._private={}))}(dcore||(dcore={}));var dcore;!function(dcore){var _private;!function(_private){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty,lastUsedSubscriptionID=0,DefaultMediator=function(){function DefaultMediator(){this.subscribers={}}return DefaultMediator.prototype.subscribe=function(topics,handler){var _this=this;_private.argumentGuard("subscribe(): ").mustBeFunction(handler,"message handler should be a function.").mustBeArray(topics,"topics should be passed as an array of strings.");var token={};topics.forEach(function(topic){return token[topic]=_this.addSubscriber(topic,handler)});var that=this;return{destroy:function(topic){return arguments.length>0?void that.unsubscribe(topic,token):void Object.keys(token).forEach(function(topic){return that.unsubscribe(topic,token)})}}},DefaultMediator.prototype.publish=function(topic,message){if(hasOwnProperty.call(this.subscribers,topic)){var subscriptions=this.subscribers[topic];Object.keys(subscriptions).forEach(function(key){var handler=subscriptions[key];setTimeout(function(){try{handler(topic,message)}catch(err){console.error('publish(): Receive "'+topic+'" message failed.'),console.error(err),console.error("Handler:"),console.error(handler)}},0)})}},DefaultMediator.prototype.addSubscriber=function(topic,handler){hasOwnProperty.call(this.subscribers,topic)||(this.subscribers[topic]={});var subscriptionID="sbscrptn"+ ++lastUsedSubscriptionID;return this.subscribers[topic][subscriptionID]=handler,subscriptionID},DefaultMediator.prototype.unsubscribe=function(topic,token){if(hasOwnProperty.call(token,topic)){var subscriptionID=token[topic];delete this.subscribers[topic][subscriptionID]}},DefaultMediator}();_private.DefaultMediator=DefaultMediator}(_private=dcore._private||(dcore._private={}))}(dcore||(dcore={}));var dcore;!function(dcore){var _private;!function(_private){"use strict";var DefaultSandbox=function(){function DefaultSandbox(core,moduleId,moduleInstanceId){_private.argumentGuard("DefaultSandbox: ").mustBeDefined(core,"core must be provided").mustBeNonEmptyString(moduleId,"module id must be a non empty string").mustBeNonEmptyString(moduleInstanceId,"module instance id must be a non empty string"),this.core=core,this.moduleId=moduleId,this.moduleInstanceId=moduleInstanceId}return DefaultSandbox.prototype.getModuleId=function(){return this.moduleId},DefaultSandbox.prototype.getModuleInstanceId=function(){return this.moduleInstanceId},DefaultSandbox.prototype.getAppState=function(){return this.core.getState()},DefaultSandbox.prototype.setAppState=function(value){this.core.setState(value)},DefaultSandbox.prototype.subscribe=function(topics,handler){return topics=Array.isArray(topics)?topics:[topics],this.core.subscribe(topics,handler)},DefaultSandbox.prototype.publish=function(topic,message){this.core.publish(topic,message)},DefaultSandbox.prototype.start=function(moduleId,props){this.core.start(moduleId,props)},DefaultSandbox.prototype.stop=function(moduleId,instanceId){this.core.stop(moduleId,instanceId)},DefaultSandbox}();_private.DefaultSandbox=DefaultSandbox}(_private=dcore._private||(dcore._private={}))}(dcore||(dcore={}));var dcore;!function(dcore){"use strict";function isDocumentReady(){return"complete"===document.readyState||"interactive"===document.readyState||"loaded"===document.readyState}function createOne(isDebug,mediator){return void 0===isDebug&&(isDebug=!0),void 0===mediator&&(mediator=new _privateData.DefaultMediator),new DefaultCore(isDebug,mediator)}var _privateData=dcore._private,hasOwnProperty=Object.prototype.hasOwnProperty,DefaultCore=function(){function DefaultCore(isDebug,mediator){void 0===isDebug&&(isDebug=!0),void 0===mediator&&(mediator=new _privateData.DefaultMediator),this.modules={},this.Sandbox=_privateData.DefaultSandbox,this.mediator=mediator,this.state={isDebug:isDebug,isRunning:!1}}return DefaultCore.prototype.getState=function(){return Object.assign({},this.state)},DefaultCore.prototype.setState=function(value){"object"==typeof value&&(value.isRunning=this.state.isRunning,value.isDebug=this.state.isDebug,this.state=Object.assign({},this.state,value))},DefaultCore.prototype.subscribe=function(topics,handler){return this.mediator.subscribe(topics,handler)},DefaultCore.prototype.publish=function(topic,message){this.mediator.publish(topic,message)},DefaultCore.prototype.register=function(moduleId,moduleFactory){_privateData.argumentGuard("register(): ").mustBeNonEmptyString(moduleId,"module id must be a non empty string").mustBeUndefined(this.modules[moduleId],"module with such id has been already registered - "+moduleId);var tempModule=moduleFactory(new this.Sandbox(this,moduleId,moduleId));_privateData.argumentGuard("register(): ").mustBeFunction(tempModule.init,"module must implement init method").mustBeFunction(tempModule.destroy,"module must implement destroy method"),this.modules[moduleId]={create:moduleFactory,instances:{}}},DefaultCore.prototype.start=function(moduleId,props){var module=this.modules[moduleId];_privateData.argumentGuard("start(): ").mustBeDefined(module,"module not found - "+moduleId);var instanceId=props&&props.instanceId?props.instanceId:moduleId;if(!hasOwnProperty.call(module.instances,instanceId)){var instance=module.create(new this.Sandbox(this,moduleId,instanceId));module.instances[instanceId]=instance,instance.init(props)}},DefaultCore.prototype.stop=function(moduleId,instanceId){var module=this.modules[moduleId],id=instanceId||moduleId;if(!module||!hasOwnProperty.call(module.instances,id))return void console.warn('stop(): "'+moduleId+'" destroy failed. "'+instanceId+'" instance not found.');try{module.instances[id].destroy()}catch(err){console.error('stop(): "'+moduleId+'" destroy failed. An error has occured within the module'),console.error(err)}finally{delete module.instances[id]}},DefaultCore.prototype.listModules=function(){return Object.keys(this.modules)},DefaultCore.prototype.run=function(action){this.state.isRunning||(this.beforeRunAction=action,isDocumentReady()?this._onDomReady(null):(this._onDomReady=this._onDomReady.bind(this),document.addEventListener("DOMContentLoaded",this._onDomReady)))},DefaultCore.prototype._onDomReady=function(ev){document.removeEventListener("DOMContentLoaded",this._onDomReady),this.state.isRunning=!0,"function"==typeof this.beforeRunAction&&this.beforeRunAction()},DefaultCore}();dcore.createOne=createOne}(dcore||(dcore={}));
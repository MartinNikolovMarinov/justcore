var spaMVP;!function(t){"use strict";function e(t){var e=this,o=t.prototype;return t.prototype=Object.create(e.prototype),n(t.prototype,o),t.prototype.constructor=t,t.BaseClass=e,t.subclass=r,t}function r(t){var r=t();if(!r||"function"!=typeof r)throw new Error("Inheritor's function constructor must be supplied.");return e.call(this,r)}function n(t,e){for(var r in e)e[r]&&(t[r]=e[r])}"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),t.subclassFactory=r,t.extend=n}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";t.ModelEvents={Change:"change",Destroy:"destroy"};var e=function(){function e(){this.listeners={}}return e.prototype.on=function(t,e,r){return!!t&&(this.listeners[t]=this.listeners[t]||[],this.listeners[t].push({handler:e,context:r}),!0)},e.prototype.off=function(t,e,r){for(var n=this.listeners[t]||[],o=0,s=n.length;o<s;o++){var i=n[o];if(i.handler===e&&i.context===r)return i=n[s-1],n.length--,!0}return!1},e.prototype.notify=function(t,e){Array.isArray(this.listeners[t])&&this.listeners[t].slice(0).forEach(function(t){return t.handler.call(t.context,e)})},e.prototype.change=function(){this.notify(t.ModelEvents.Change,this)},e.prototype.destroy=function(){this.notify(t.ModelEvents.Destroy,this)},e.subclass=t.subclassFactory,e}();t.Model=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";var e=function(){function t(){this.items={},this.size=0}return t.prototype.contains=function(t){var e=t.hash();if(!Object.prototype.hasOwnProperty.call(this.items,e))return!1;var r=this.items[e];if(!Array.isArray(r))return r.equals(t);for(var n=0,o=r.length;n<o;n++)if(r[n].equals(t))return!0;return!1},t.prototype.add=function(t){if(this.contains(t))return!1;var e=t.hash();return Object.prototype.hasOwnProperty.call(this.items,e)?Array.isArray(this.items[e])?this.items[e].push(t):this.items[e]=[this.items[e],t]:this.items[e]=t,this.size++,!0},t.prototype.remove=function(t){if(!this.contains(t))return!1;var e=t.hash();if(Array.isArray(this.items[e])){for(var r=this.items[e],n=0,o=r.length;n<o;n++)if(r[n].equals(t)){r[n]=r[o-1],r.length--;break}}else delete this.items[e];return this.size--,!0},t.prototype.clear=function(){return!(this.size<=0)&&(this.items={},this.size=0,!0)},t.prototype.forEach=function(t,e){for(var r=0,n=Object.keys(this.items),o=0,s=n.length;o<s;o++){var i=this.items[n[o]];if(Array.isArray(i))for(var u=0,a=i.length;u<a;u++)t.call(e,i[u],r),r++;else t.call(e,i,r),r++}},t.prototype.toArray=function(){for(var t=new Array(this.size),e=0,r=Object.keys(this.items),n=0,o=r.length;n<o;n++){var s=this.items[r[n]];if(Array.isArray(s))for(var i=0,u=s.length;i<u;i++)t[e]=s[i],e++;else t[e]=s,e++}return t},t}();t.HashSet=e}(spaMVP||(spaMVP={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},spaMVP;!function(t){"use strict";t.CollectionEvents={AddedItems:"added-items",DeletedItems:"deleted-items",UpdatedItem:"updated-item"};var e=function(e){function r(){e.call(this),this.models=new t.HashSet}return __extends(r,e),Object.defineProperty(r.prototype,"size",{get:function(){return this.models.size},enumerable:!0,configurable:!0}),r.prototype.equals=function(t){return!1},r.prototype.hash=function(){return 17^this.size},r.prototype.add=function(t){return this.addRange([t])},r.prototype.addRange=function(e){for(var r=[],n=0,o=e.length;n<o;n++){var s=e[n];this.models.add(s)&&(s.on(t.ModelEvents.Change,this.onItemChange,this),s.on(t.ModelEvents.Destroy,this.onItemDestroy,this),r.push(s))}var i=r.length>0;return i&&this.notify(t.CollectionEvents.AddedItems,r),i},r.prototype.remove=function(t){return this.removeRange([t])},r.prototype.removeRange=function(e){for(var r=[],n=0,o=e.length;n<o;n++){var s=e[n];this.models.remove(s)&&(s.off(t.ModelEvents.Change,this.onItemChange,this),s.off(t.ModelEvents.Destroy,this.onItemDestroy,this),r.push(s))}var i=r.length>0;return i&&this.notify(t.CollectionEvents.DeletedItems,r),i},r.prototype.clear=function(){return this.removeRange(this.toArray())},r.prototype.contains=function(t){return this.models.contains(t)},r.prototype.any=function(){return this.size>0},r.prototype.toArray=function(){return this.models.toArray()},r.prototype.forEach=function(t,e){this.models.forEach(t,e)},r.prototype.onItemChange=function(e){this.notify(t.CollectionEvents.UpdatedItem,e)},r.prototype.onItemDestroy=function(t){this.removeRange([t])},r.subclass=t.subclassFactory,r}(t.Model);t.Collection=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){function e(t){var e,r,n,o;e=this.events[t],o=e.useCapture,r=e.eventType,n=e.handler,this.removeEventListener(r,n,o),delete this.eventsList[t]}function r(t){var r;if(void 0===t||""===t){for(r in this.eventsList)e.call(this,r);this.eventsList={}}else this.hasEvent(t)&&e.call(this,t);return this.eventsList}function n(t){return"object"==typeof this.eventsList[t]&&this.eventsList[t]}function o(t){var e=this.hasEvent(t);return"function"==typeof e.handler&&e.handler()}function s(t){return this instanceof s?(this.htmlElement=t.htmlElement,this.eventConfig={name:t.name,eventType:t.eventType,handler:void 0!==t.handler&&t.handler,useCapture:void 0!==t.useCapture&&t.useCapture,context:void 0===t.context?null:t.context},void this.init()):new s(t)}Element.prototype.trigger=function(){return!1},Element.prototype.hasEvent=function(){return!1},Element.prototype.detach=function(){return!1},Element.prototype.events=!1,t.UIEvent=s,s.prototype.init=function(){if(void 0===this.htmlElement.eventsList)Object.defineProperties(this.htmlElement,{eventsList:{writable:!0,enumerable:!1,configurable:!1,value:{}},events:{enumerable:!1,configurable:!1,get:function(){return this.eventsList},set:function(t){return this.eventsList[t.name]=t}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:o},hasEvent:{writable:!1,enumerable:!1,configurable:!1,value:n},detach:{writable:!1,enumerable:!1,configurable:!1,value:r}});else if(this.htmlElement.hasEvent(this.eventConfig.name))return!1;this.eventConfig.handler=this.eventConfig.handler.bind(this.eventConfig.context||this),this.htmlElement.addEventListener(this.eventConfig.eventType,this.eventConfig.handler,this.eventConfig.useCapture),this.htmlElement.events=this.eventConfig},Object.defineProperties(s.prototype,{detach:{writable:!1,enumerable:!1,configurable:!1,value:function(t){return r.call(this.htmlElement,t)}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:function(t){return o.call(this.htmlElement,t||this.eventConfig.name)}}})}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";function e(t){var e=t.target,r=e.dataset;if(r.hasOwnProperty(t.type)){var n=r[t.type];return"function"==typeof this[n]?void this[n](r,e,t):void 0}}var r=function(){function r(t,e){if(!t)throw new Error("Dom node cannot be null.");this._domNode=t,this._template=e}return Object.defineProperty(r.prototype,"domNode",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),r.prototype.map=function(r,n,o){return void 0===n&&(n=!1),t.UIEvent({name:r,htmlElement:o?this.domNode.querySelector(o):this.domNode,handler:e,eventType:r,context:this,useCapture:n}),this},r.prototype.render=function(t){return this._template&&(this.domNode.innerHTML=this._template.call(this,t)),this.domNode},r.prototype.destroy=function(){return"function"==typeof this.domNode.detach&&this.domNode.detach(),this.removeAllElements(),this._domNode=null,this},r.prototype.query=function(t){return this.domNode.querySelector(t)},r.prototype.removeElement=function(t){var e=this.query(t);return e&&e.parentElement.removeChild(e),this},r.prototype.removeAllElements=function(){for(;this.domNode.firstElementChild;)this.domNode.removeChild(this.domNode.firstElementChild);return this},r.subclass=t.subclassFactory,r}();t.View=r}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";var e=function(){function e(){this._view=null,this._model=null,this._modelHandlers={}}return Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(t){this.view!==t&&(this.view&&this.view.destroy(),this._view=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){return this._model},set:function(t){var e=this;this._model!==t&&(Object.keys(this._modelHandlers).forEach(function(r){var n=e._modelHandlers[r];e._model&&e._model.off(r,n,e),t&&t.on(r,n,e)}),this._model=t,this.render())},enumerable:!0,configurable:!0}),e.prototype.onModel=function(t,e){return t&&e&&(this._modelHandlers[t]=e),this},e.prototype.render=function(){return this.view&&this.model?this.view.render(this.model):null},e.prototype.destroy=function(){this.view=null,this.model=null},e.subclass=t.subclassFactory,e}();t.Presenter=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";var e=function(){function t(){this.questionMarkIndex=-1,this.url="",this.tokens=[],this.queryParams=[]}return Object.defineProperty(t.prototype,"value",{get:function(){return this.url},set:function(t){t=t||"",this.url=t,this.questionMarkIndex=t.indexOf("?"),this.queryParams=[],this.tokens=[],this.populateQueryParams(),this.populateTokens()},enumerable:!0,configurable:!0}),t.prototype.anyQueryParams=function(){return this.questionMarkIndex>-1},t.prototype.populateQueryParams=function(){var t=this;this.anyQueryParams()&&(this.queryParams=this.value.substring(this.questionMarkIndex+1).split("&").map(function(e){return t.parseQueryParam(e)}))},t.prototype.parseQueryParam=function(t){var e=t.split("=");return{key:e[0],value:e[1]||""}},t.prototype.populateTokens=function(){var t=this.getValueWithoutQuery();this.tokens=t.split("/").filter(function(t){return""!==t})},t.prototype.getValueWithoutQuery=function(){return this.anyQueryParams()?this.value.substring(0,this.value.length-(this.value.length-this.questionMarkIndex)):this.value},t}();t.UrlHash=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";var e=/{([a-zA-Z]+)}/,r=function(){function t(t,e){if(this.tokens=[],"undefined"==typeof t||"string"!=typeof t||null===t)throw new Error("Route pattern should be non empty string.");this.pattern=t,this.callback=e,this.populateTokens()}return t.prototype.getTokens=function(){return this.tokens.slice(0)},t.prototype.equals=function(t){if(this.tokens.length!==t.tokens.length)return!1;for(var e=0,r=this.tokens.length;e<r;e++){var n=this.tokens[e],o=t.tokens[e];if(!n.isDynamic&&n.name.toLowerCase()!==o.toLowerCase())return!1}return!0},t.prototype.start=function(t){var e=this.getParamsFromUrl(t);this.callback&&this.callback(e)},t.prototype.populateTokens=function(){var t=this;this.tokens=[],this.pattern.split("/").forEach(function(e){""!==e&&t.tokens.push(t.parseToken(e))})},t.prototype.parseToken=function(t){var r=e.exec(t),n=!!r;return{name:n?r[1]:t,isDynamic:n}},t.prototype.getParamsFromUrl=function(t){var e=this.getQueryParamsFromUrl(t);return this.tokens.forEach(function(r,n){r.isDynamic&&(e[r.name]=t.tokens[n])}),e},t.prototype.getQueryParamsFromUrl=function(t){var e={};return t.queryParams.forEach(function(t){return e[t.key]=t.value}),e},t}();t.Route=r}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";var e=function(){function e(){this.routes=[],this.urlHash=new t.UrlHash,this.defaultUrl=null}return e.prototype.registerRoute=function(e,r){if(this.routes.some(function(t){return t.pattern===e}))throw new Error("Route "+e+" has been already registered.");this.routes.push(new t.Route(e,r))},e.prototype.startRoute=function(t){this.urlHash.value=t;var e=this.findRoute();return e?void e.start(this.urlHash):void(this.defaultUrl?this.startDefaultRoute(t):console.warn("No route handler for "+t))},e.prototype.getRoutes=function(){return this.routes.map(function(t){return t.pattern})},e.prototype.hasRoutes=function(){return this.routes.length>0},e.prototype.findRoute=function(){for(var t=0,e=this.routes.length;t<e;t++){var r=this.routes[t];if(r.equals(this.urlHash))return r}return null},e.prototype.startDefaultRoute=function(t){window.history.replaceState(null,null,window.location.pathname+"#"+this.defaultUrl),this.urlHash.value=this.defaultUrl;var e=this.findRoute();e?e.start(this.urlHash):console.warn("No route handler for "+t)},e}();t.DefaultRouteConfig=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";var e=function(){function t(t,e){if(!t||!e)throw new Error("Missing core or module instance ID");this.core=t,this.moduleInstanceId=e}return t.prototype.subscribe=function(t,e,r){this.core.subscribe(t,e,r)},t.prototype.unsubscribe=function(t,e,r){this.core.unsubscribe(t,e,r)},t.prototype.publish=function(t,e){this.core.publish(t,e)},t.prototype.getService=function(t){return this.core.getService(t)},t}();t.Sandbox=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){"use strict";function e(t){var e=this;document.removeEventListener("DOMContentLoaded",this.onDomReady),this.onAppStart&&this.onAppStart(),this.routeConfig.hasRoutes()&&(this.routeConfig.startRoute(window.location.hash.substring(1)),window.addEventListener("hashchange",function(){e.routeConfig.startRoute(window.location.hash.substring(1))}))}function r(t){return new n(t)}var n=function(){function r(r){void 0===r&&(r=new t.DefaultRouteConfig),this.onDomReady=e.bind(this),this.subscribers={},this.modules={},this.services={},this.routeConfig=r}return r.prototype.run=function(t){return this.onAppStart=t,document.addEventListener("DOMContentLoaded",this.onDomReady),this},r.prototype.registerRoute=function(t,e){return this.routeConfig.registerRoute(t,e),this},r.prototype.startRoute=function(t){return this.routeConfig.startRoute(t),this},r.prototype.defaultUrl=function(t){return this.routeConfig.defaultUrl=t,this},r.prototype.subscribe=function(t,e,r){if("function"!=typeof e)throw new TypeError("Event type handler should be a function");if(Array.isArray(t))for(var n=0,o=t.length;n<o;n++)this.addSubscriber(t[n],e,r)},r.prototype.unsubscribe=function(t,e,r){if(Array.isArray(t))for(var n=0,o=t.length;n<o;n++)this.removeSubscriber(t[n],e,r)},r.prototype.publish=function(t,e){Array.isArray(this.subscribers[t])&&this.subscribers[t].slice(0).forEach(function(r){return r.handler.call(r.context,t,e)})},r.prototype.register=function(e,r){if(""===e||"string"!=typeof e)throw new TypeError(e+" Module registration FAILED: ID must be a non empty string.");if(this.modules[e])throw new TypeError(e+" Module registration FAILED: a module with such id has been already registered.");var n=r(new t.Sandbox(this,e));if("function"!=typeof n.init||"function"!=typeof n.destroy)throw new TypeError(e+" Module registration FAILED: Module has no init or destroy methods.");return this.modules[e]={create:r,instances:null},this},r.prototype.getAllModules=function(){return Object.keys(this.modules)},r.prototype.start=function(e,r){var n=this.modules[e];if(!n)throw new ReferenceError(e+" Module not found.");if(r=r||{},"object"!=typeof r)throw new TypeError(e+" Module's options must be an object.");n.instances=n.instances||{};var o=r.instanceId||e;if(n.instances.hasOwnProperty(o))return this;var s=n.create(new t.Sandbox(this,o));return n.instances[o]=s,s.init(r),this},r.prototype.stop=function(t,e){var r=this.modules[t],n=e||t;return r&&r.instances&&r.instances.hasOwnProperty(n)&&(r.instances[n].destroy(),delete r.instances[n]),this},r.prototype.addService=function(t,e){if("string"!=typeof t||""===t)throw new TypeError(t+" Service registration FAILED: ID must be non empty string.");if(this.services[t])throw new TypeError(t+" Service registration FAILED: a service with such id has been already added.");return this.services[t]=e,this},r.prototype.getService=function(e){var r=this.services[e];if(!r)throw new ReferenceError(e+" Service was not found.");return r(new t.Sandbox(this,e))},r.prototype.addSubscriber=function(t,e,r){this.subscribers[t]=this.subscribers[t]||[],this.subscribers[t].push({handler:e,context:r})},r.prototype.removeSubscriber=function(t,e,r){for(var n=this.subscribers[t]||[],o=0,s=n.length;o<s;o++){var i=n[o];if(i.handler===e&&i.context===r)return n[o]=n[s-1],void n.length--}},r}();t.Core=n,t.createAppCore=r}(spaMVP||(spaMVP={}));
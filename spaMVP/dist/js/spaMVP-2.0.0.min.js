/**
 *  @license spaMVP - v2.0.0
 *  Copyright Â© 2016 Valentin Lozev
 *  Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 *  Source code: http://github.com/valentin-lozev/spaMVP
 */
var spaMVP;!function(spaMVP){"use strict";function subclass(inheritor){var BaseClass=this,prototype=inheritor.prototype;return inheritor.prototype=Object.create(BaseClass.prototype),extend(inheritor.prototype,prototype),inheritor.prototype.constructor=inheritor,inheritor.BaseClass=BaseClass,inheritor.subclass=subclassFactory,inheritor}function subclassFactory(getInheritorFunc){var inheritor=getInheritorFunc();if(!inheritor||"function"!=typeof inheritor)throw new Error("Inheritor's function constructor must be supplied.");return subclass.call(this,inheritor)}function extend(target,object){for(var prop in object)object[prop]&&(target[prop]=object[prop])}"function"!=typeof Object.create&&(Object.create=function(o){function F(){}return F.prototype=o,new F}),spaMVP.subclassFactory=subclassFactory,spaMVP.extend=extend}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){"use strict";spaMVP.ModelEvents={Change:"change",Destroy:"destroy"};var Model=function(){function Model(){this.listeners={}}return Model.prototype.on=function(eventType,handler,context){return!!eventType&&(this.listeners[eventType]=this.listeners[eventType]||[],this.listeners[eventType].push({handler:handler,context:context}),!0)},Model.prototype.off=function(eventType,handler,context){for(var listeners=this.listeners[eventType]||[],i=0,len=listeners.length;i<len;i++){var listener=listeners[i];if(listener.handler===handler&&listener.context===context)return listener=listeners[len-1],listeners.length--,!0}return!1},Model.prototype.notify=function(type,data){Array.isArray(this.listeners[type])&&this.listeners[type].slice(0).forEach(function(listener){return listener.handler.call(listener.context,data)})},Model.prototype.change=function(){this.notify(spaMVP.ModelEvents.Change,this)},Model.prototype.destroy=function(){this.notify(spaMVP.ModelEvents.Destroy,this)},Model.subclass=spaMVP.subclassFactory,Model}();spaMVP.Model=Model}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){var Hidden;!function(Hidden){"use strict";var HashSet=function(){function HashSet(){this.items={},this.size=0}return HashSet.prototype.contains=function(item){var hashCode=item.hash();if(!Object.prototype.hasOwnProperty.call(this.items,hashCode))return!1;var hashedItems=this.items[hashCode];if(!Array.isArray(hashedItems))return hashedItems.equals(item);for(var i=0,len=hashedItems.length;i<len;i++)if(hashedItems[i].equals(item))return!0;return!1},HashSet.prototype.add=function(item){if(this.contains(item))return!1;var hashCode=item.hash();return Object.prototype.hasOwnProperty.call(this.items,hashCode)?Array.isArray(this.items[hashCode])?this.items[hashCode].push(item):this.items[hashCode]=[this.items[hashCode],item]:this.items[hashCode]=item,this.size++,!0},HashSet.prototype.remove=function(item){if(!this.contains(item))return!1;var hashCode=item.hash();if(Array.isArray(this.items[hashCode])){for(var hashCodeItems=this.items[hashCode],i=0,len=hashCodeItems.length;i<len;i++)if(hashCodeItems[i].equals(item)){hashCodeItems[i]=hashCodeItems[len-1],hashCodeItems.length--;break}}else delete this.items[hashCode];return this.size--,!0},HashSet.prototype.clear=function(){return!(this.size<=0)&&(this.items={},this.size=0,!0)},HashSet.prototype.forEach=function(action,context){for(var index=0,hashes=Object.keys(this.items),i=0,len=hashes.length;i<len;i++){var hashIndexItem=this.items[hashes[i]];if(Array.isArray(hashIndexItem))for(var j=0,hashLength=hashIndexItem.length;j<hashLength;j++)action.call(context,hashIndexItem[j],index),index++;else action.call(context,hashIndexItem,index),index++}},HashSet.prototype.toArray=function(){for(var result=new Array(this.size),index=0,hashes=Object.keys(this.items),i=0,hashesLen=hashes.length;i<hashesLen;i++){var hashIndexItem=this.items[hashes[i]];if(Array.isArray(hashIndexItem))for(var j=0,len=hashIndexItem.length;j<len;j++)result[index]=hashIndexItem[j],index++;else result[index]=hashIndexItem,index++}return result},HashSet}();Hidden.HashSet=HashSet}(Hidden=spaMVP.Hidden||(spaMVP.Hidden={}))}(spaMVP||(spaMVP={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},spaMVP;!function(spaMVP){"use strict";function onItemChange(item){this.notify(spaMVP.CollectionEvents.UpdatedItem,item)}function onItemDestroy(item){this.removeRange([item])}var hidden=spaMVP.Hidden;spaMVP.CollectionEvents={AddedItems:"added-items",DeletedItems:"deleted-items",UpdatedItem:"updated-item"};var Collection=function(_super){function Collection(){_super.call(this),this.models=new hidden.HashSet}return __extends(Collection,_super),Object.defineProperty(Collection.prototype,"size",{get:function(){return this.models.size},enumerable:!0,configurable:!0}),Collection.prototype.equals=function(other){return!1},Collection.prototype.hash=function(){return 17^this.size},Collection.prototype.add=function(model){return this.addRange([model])},Collection.prototype.addRange=function(models){for(var added=[],i=0,len=models.length;i<len;i++){var model=models[i];this.models.add(model)&&(model.on(spaMVP.ModelEvents.Change,onItemChange,this),model.on(spaMVP.ModelEvents.Destroy,onItemDestroy,this),added.push(model))}var isModified=added.length>0;return isModified&&this.notify(spaMVP.CollectionEvents.AddedItems,added),isModified},Collection.prototype.remove=function(model){return this.removeRange([model])},Collection.prototype.removeRange=function(models){for(var deleted=[],i=0,len=models.length;i<len;i++){var model=models[i];this.models.remove(model)&&(model.off(spaMVP.ModelEvents.Change,onItemChange,this),model.off(spaMVP.ModelEvents.Destroy,onItemDestroy,this),deleted.push(model))}var isModified=deleted.length>0;return isModified&&this.notify(spaMVP.CollectionEvents.DeletedItems,deleted),isModified},Collection.prototype.clear=function(){return this.removeRange(this.toArray())},Collection.prototype.contains=function(model){return this.models.contains(model)},Collection.prototype.any=function(){return this.size>0},Collection.prototype.toArray=function(){return this.models.toArray()},Collection.prototype.forEach=function(action,context){this.models.forEach(action,context)},Collection.subclass=spaMVP.subclassFactory,Collection}(spaMVP.Model);spaMVP.Collection=Collection}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){var Hidden;!function(Hidden){"use strict";function removeEvent(name){var ev,type,handler,useCapture;ev=this.events[name],useCapture=ev.useCapture,type=ev.eventType,handler=ev.handler,this.removeEventListener(type,handler,useCapture),delete this.eventsList[name]}function detachEvent(name){var i;if(void 0===name||""===name){for(i in this.eventsList)removeEvent.call(this,i);this.eventsList={}}else this.hasEvent(name)&&removeEvent.call(this,name);return this.eventsList}function hasEvent(name){return"object"==typeof this.eventsList[name]&&this.eventsList[name]}function triggerEvent(name){var evt=this.hasEvent(name);return"function"==typeof evt.handler&&evt.handler()}function UIEvent(config){return this instanceof UIEvent?(this.htmlElement=config.htmlElement,this.eventConfig={name:config.name,eventType:config.eventType,handler:void 0!==config.handler&&config.handler,useCapture:void 0!==config.useCapture&&config.useCapture,context:void 0===config.context?null:config.context},void this.init()):new UIEvent(config)}Element.prototype.trigger=function(){return!1},Element.prototype.hasEvent=function(){return!1},Element.prototype.detach=function(){return!1},Element.prototype.events=!1,Hidden.UIEvent=UIEvent,UIEvent.prototype.init=function(){if(void 0===this.htmlElement.eventsList)Object.defineProperties(this.htmlElement,{eventsList:{writable:!0,enumerable:!1,configurable:!1,value:{}},events:{enumerable:!1,configurable:!1,get:function(){return this.eventsList},set:function(e){return this.eventsList[e.name]=e}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:triggerEvent},hasEvent:{writable:!1,enumerable:!1,configurable:!1,value:hasEvent},detach:{writable:!1,enumerable:!1,configurable:!1,value:detachEvent}});else if(this.htmlElement.hasEvent(this.eventConfig.name))return!1;this.eventConfig.handler=this.eventConfig.handler.bind(this.eventConfig.context||this),this.htmlElement.addEventListener(this.eventConfig.eventType,this.eventConfig.handler,this.eventConfig.useCapture),this.htmlElement.events=this.eventConfig},Object.defineProperties(UIEvent.prototype,{detach:{writable:!1,enumerable:!1,configurable:!1,value:function(name){return detachEvent.call(this.htmlElement,name)}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:function(name){return triggerEvent.call(this.htmlElement,name||this.eventConfig.name)}}})}(Hidden=spaMVP.Hidden||(spaMVP.Hidden={}))}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){"use strict";function eventHandler(ev){var target=ev.target,dataset=target.dataset;if(dataset.hasOwnProperty(ev.type)){var callbackName=dataset[ev.type];return"function"==typeof this[callbackName]?void this[callbackName](dataset,target,ev):void 0}}var hidden=spaMVP.Hidden,View=function(){function View(domNode,template){if(!domNode)throw new Error("Dom node cannot be null.");this._domNode=domNode,this._template=template}return Object.defineProperty(View.prototype,"domNode",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),View.prototype.map=function(eventType,useCapture,selector){return void 0===useCapture&&(useCapture=!1),hidden.UIEvent({name:eventType,htmlElement:selector?this.domNode.querySelector(selector):this.domNode,handler:eventHandler,eventType:eventType,context:this,useCapture:useCapture}),this},View.prototype.render=function(model){return this._template&&(this.domNode.innerHTML=this._template.call(this,model)),this.domNode},View.prototype.destroy=function(){return"function"==typeof this.domNode.detach&&this.domNode.detach(),this.removeAllElements(),this._domNode=null,this},View.prototype.query=function(selector){return this.domNode.querySelector(selector)},View.prototype.removeElement=function(selector){var element=this.query(selector);return element&&element.parentElement.removeChild(element),this},View.prototype.removeAllElements=function(){for(;this.domNode.firstElementChild;)this.domNode.removeChild(this.domNode.firstElementChild);return this},View.subclass=spaMVP.subclassFactory,View}();spaMVP.View=View}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){"use strict";var Presenter=function(){function Presenter(){this._view=null,this._model=null,this._modelHandlers={}}return Object.defineProperty(Presenter.prototype,"view",{get:function(){return this._view},set:function(value){this.view!==value&&(this.view&&this.view.destroy(),this._view=value)},enumerable:!0,configurable:!0}),Object.defineProperty(Presenter.prototype,"model",{get:function(){return this._model},set:function(model){var _this=this;this._model!==model&&(Object.keys(this._modelHandlers).forEach(function(type){var eventHandler=_this._modelHandlers[type];_this._model&&_this._model.off(type,eventHandler,_this),model&&model.on(type,eventHandler,_this)}),this._model=model,this.render())},enumerable:!0,configurable:!0}),Presenter.prototype.onModel=function(eventType,handler){return eventType&&handler&&(this._modelHandlers[eventType]=handler),this},Presenter.prototype.render=function(){return this.view&&this.model?this.view.render(this.model):null},Presenter.prototype.destroy=function(){this.view=null,this.model=null},Presenter.subclass=spaMVP.subclassFactory,Presenter}();spaMVP.Presenter=Presenter}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){var Hidden;!function(Hidden){"use strict";var UrlHash=function(){function UrlHash(){this.questionMarkIndex=-1,this.url="",this.tokens=[],this.queryParams=[]}return Object.defineProperty(UrlHash.prototype,"value",{get:function(){return this.url},set:function(url){url=url||"",this.url=url,this.questionMarkIndex=url.indexOf("?"),this.queryParams=[],this.tokens=[],this.populateQueryParams(),this.populateTokens()},enumerable:!0,configurable:!0}),UrlHash.prototype.anyQueryParams=function(){return this.questionMarkIndex>-1},UrlHash.prototype.populateQueryParams=function(){var _this=this;this.anyQueryParams()&&(this.queryParams=this.value.substring(this.questionMarkIndex+1).split("&").map(function(keyValuePairString){return _this.parseQueryParam(keyValuePairString)}))},UrlHash.prototype.parseQueryParam=function(keyValuePair){var args=keyValuePair.split("=");return{key:args[0],value:args[1]||""}},UrlHash.prototype.populateTokens=function(){var valueWithoutQuery=this.getValueWithoutQuery();this.tokens=valueWithoutQuery.split("/").filter(function(token){return""!==token})},UrlHash.prototype.getValueWithoutQuery=function(){return this.anyQueryParams()?this.value.substring(0,this.value.length-(this.value.length-this.questionMarkIndex)):this.value},UrlHash}();Hidden.UrlHash=UrlHash}(Hidden=spaMVP.Hidden||(spaMVP.Hidden={}))}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){var Hidden;!function(Hidden){"use strict";var routeParamRegex=/{([a-zA-Z]+)}/,Route=function(){function Route(pattern,onStart){if(this.tokens=[],"undefined"==typeof pattern||"string"!=typeof pattern||null===pattern)throw new Error("Route pattern should be non empty string.");this.pattern=pattern,this.callback=onStart,this.populateTokens()}return Route.prototype.getTokens=function(){return this.tokens.slice(0)},Route.prototype.equals=function(hashUrl){if(this.tokens.length!==hashUrl.tokens.length)return!1;for(var i=0,len=this.tokens.length;i<len;i++){var token=this.tokens[i],urlToken=hashUrl.tokens[i];if(!token.isDynamic&&token.name.toLowerCase()!==urlToken.toLowerCase())return!1}return!0},Route.prototype.start=function(urlHash){var queryParams=this.getParamsFromUrl(urlHash);this.callback&&this.callback(queryParams)},Route.prototype.populateTokens=function(){var _this=this;this.tokens=[],this.pattern.split("/").forEach(function(urlFragment){""!==urlFragment&&_this.tokens.push(_this.parseToken(urlFragment))})},Route.prototype.parseToken=function(urlFragment){var paramMatchGroups=routeParamRegex.exec(urlFragment),isDynamic=!!paramMatchGroups;return{name:isDynamic?paramMatchGroups[1]:urlFragment,isDynamic:isDynamic}},Route.prototype.getParamsFromUrl=function(url){var result=this.getQueryParamsFromUrl(url);return this.tokens.forEach(function(token,index){token.isDynamic&&(result[token.name]=url.tokens[index])}),result},Route.prototype.getQueryParamsFromUrl=function(url){var result={};return url.queryParams.forEach(function(param){return result[param.key]=param.value}),result},Route}();Hidden.Route=Route}(Hidden=spaMVP.Hidden||(spaMVP.Hidden={}))}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){var Hidden;!function(Hidden){"use strict";var DefaultRouteConfig=function(){function DefaultRouteConfig(){this.routes=[],this.urlHash=new Hidden.UrlHash,this.defaultUrl=null}return DefaultRouteConfig.prototype.registerRoute=function(pattern,callback){if(this.routes.some(function(r){return r.pattern===pattern}))throw new Error("Route "+pattern+" has been already registered.");this.routes.push(new Hidden.Route(pattern,callback))},DefaultRouteConfig.prototype.startRoute=function(hash){this.urlHash.value=hash;var nextRoute=this.findRoute();return nextRoute?void nextRoute.start(this.urlHash):void(this.defaultUrl?this.startDefaultRoute(hash):console.warn("No route handler for "+hash))},DefaultRouteConfig.prototype.getRoutes=function(){return this.routes.map(function(route){return route.pattern})},DefaultRouteConfig.prototype.hasRoutes=function(){return this.routes.length>0},DefaultRouteConfig.prototype.findRoute=function(){for(var i=0,len=this.routes.length;i<len;i++){var route=this.routes[i];if(route.equals(this.urlHash))return route}return null},DefaultRouteConfig.prototype.startDefaultRoute=function(invalidHash){window.history.replaceState(null,null,window.location.pathname+"#"+this.defaultUrl),this.urlHash.value=this.defaultUrl;var nextRoute=this.findRoute();nextRoute?nextRoute.start(this.urlHash):console.warn("No route handler for "+invalidHash)},DefaultRouteConfig}();Hidden.DefaultRouteConfig=DefaultRouteConfig}(Hidden=spaMVP.Hidden||(spaMVP.Hidden={}))}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){"use strict";var Sandbox=function(){function Sandbox(core,moduleInstanceId){if(!core||!moduleInstanceId)throw new Error("Missing core or module instance ID");this.core=core,this.moduleInstanceId=moduleInstanceId}return Sandbox.prototype.subscribe=function(eventTypes,handler,context){this.core.subscribe(eventTypes,handler,context)},Sandbox.prototype.unsubscribe=function(eventTypes,handler,context){this.core.unsubscribe(eventTypes,handler,context)},Sandbox.prototype.publish=function(eventType,data){this.core.publish(eventType,data)},Sandbox.prototype.getService=function(id){return this.core.getService(id)},Sandbox}();spaMVP.Sandbox=Sandbox}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){"use strict";function initialize(ev){var _this=this;document.removeEventListener("DOMContentLoaded",this.onDomReady),this.onAppStart&&this.onAppStart(),this.routeConfig.hasRoutes()&&(this.routeConfig.startRoute(window.location.hash.substring(1)),window.addEventListener("hashchange",function(){_this.routeConfig.startRoute(window.location.hash.substring(1))}))}function addSubscriber(eventType,handler,context){this.subscribers[eventType]=this.subscribers[eventType]||[],this.subscribers[eventType].push({handler:handler,context:context})}function removeSubscriber(eventType,handler,context){for(var subscribers=this.subscribers[eventType]||[],i=0,len=subscribers.length;i<len;i++){var subscriber=subscribers[i];if(subscriber.handler===handler&&subscriber.context===context)return subscribers[i]=subscribers[len-1],void subscribers.length--}}function createAppCore(routeConfig){return new Core(routeConfig)}var hidden=spaMVP.Hidden,Core=function(){function Core(routeConfig){void 0===routeConfig&&(routeConfig=new hidden.DefaultRouteConfig),this.onDomReady=initialize.bind(this),this.subscribers={},this.modules={},this.services={},this.routeConfig=routeConfig}return Core.prototype.run=function(action){return this.onAppStart=action,document.addEventListener("DOMContentLoaded",this.onDomReady),this},Core.prototype.registerRoute=function(pattern,callback){return this.routeConfig.registerRoute(pattern,callback),this},Core.prototype.startRoute=function(hash){return this.routeConfig.startRoute(hash),this},Core.prototype.defaultUrl=function(url){return this.routeConfig.defaultUrl=url,this},Core.prototype.subscribe=function(eventTypes,handler,context){if("function"!=typeof handler)throw new TypeError("Event type handler should be a function");if(Array.isArray(eventTypes))for(var i=0,len=eventTypes.length;i<len;i++)addSubscriber.call(this,eventTypes[i],handler,context)},Core.prototype.unsubscribe=function(eventTypes,handler,context){if(Array.isArray(eventTypes))for(var i=0,len=eventTypes.length;i<len;i++)removeSubscriber.call(this,eventTypes[i],handler,context)},Core.prototype.publish=function(type,data){Array.isArray(this.subscribers[type])&&this.subscribers[type].slice(0).forEach(function(subscriber){return subscriber.handler.call(subscriber.context,type,data)})},Core.prototype.register=function(moduleId,moduleFactory){if(""===moduleId||"string"!=typeof moduleId)throw new TypeError(moduleId+" Module registration FAILED: ID must be a non empty string.");if(this.modules[moduleId])throw new TypeError(moduleId+" Module registration FAILED: a module with such id has been already registered.");var tempModule=moduleFactory(new spaMVP.Sandbox(this,moduleId));if("function"!=typeof tempModule.init||"function"!=typeof tempModule.destroy)throw new TypeError(moduleId+" Module registration FAILED: Module has no init or destroy methods.");return this.modules[moduleId]={create:moduleFactory,instances:null},this},Core.prototype.getAllModules=function(){return Object.keys(this.modules)},Core.prototype.start=function(moduleId,options){var module=this.modules[moduleId];if(!module)throw new ReferenceError(moduleId+" Module not found.");if(options=options||{},"object"!=typeof options)throw new TypeError(moduleId+" Module's options must be an object.");module.instances=module.instances||{};var instanceId=options.instanceId||moduleId;if(module.instances.hasOwnProperty(instanceId))return this;var instance=module.create(new spaMVP.Sandbox(this,instanceId));return module.instances[instanceId]=instance,instance.init(options),this},Core.prototype.stop=function(moduleId,instanceId){var module=this.modules[moduleId],id=instanceId||moduleId;return module&&module.instances&&module.instances.hasOwnProperty(id)&&(module.instances[id].destroy(),delete module.instances[id]),this},Core.prototype.addService=function(id,factory){if("string"!=typeof id||""===id)throw new TypeError(id+" Service registration FAILED: ID must be non empty string.");if(this.services[id])throw new TypeError(id+" Service registration FAILED: a service with such id has been already added.");return this.services[id]=factory,this},Core.prototype.getService=function(id){var service=this.services[id];if(!service)throw new ReferenceError(id+" Service was not found.");return service(new spaMVP.Sandbox(this,id))},Core}();spaMVP.Core=Core,spaMVP.createAppCore=createAppCore}(spaMVP||(spaMVP={}));var spaMVP;!function(spaMVP){delete spaMVP.Hidden}(spaMVP||(spaMVP={}));
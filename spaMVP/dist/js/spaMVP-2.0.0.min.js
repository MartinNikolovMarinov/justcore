var spaMVP;!function(t){function e(t){var e=this,o=t.prototype;return t.prototype=Object.create(e.prototype),r(t.prototype,o),t.prototype.constructor=t,t.BaseClass=e,t.subclass=n,t}function n(t){var n=t();if(!n||"function"!=typeof n)throw new Error("Inheritor's function constructor must be supplied.");return e.call(this,n)}function r(t,e){for(var n in e)e[n]&&(t[n]=e[n])}"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),t.subclassFactory=n,t.extend=r}(spaMVP||(spaMVP={}));var spaMVP;!function(t){t.ModelEvents={Change:"change",Destroy:"destroy"};var e=function(){function e(){this.listeners={}}return e.prototype.on=function(t,e,n){return!!t&&(this.listeners[t]=this.listeners[t]||[],this.listeners[t].push({handler:e,context:n}),!0)},e.prototype.off=function(t,e,n){for(var r=this.listeners[t]||[],o=0,i=r.length;o<i;o++){var s=r[o];if(s.handler===e&&s.context===n)return s=r[i-1],r.length--,!0}return!1},e.prototype.notify=function(t,e){Array.isArray(this.listeners[t])&&this.listeners[t].slice(0).forEach(function(t){return t.handler.call(t.context,e)})},e.prototype.change=function(){this.notify(t.ModelEvents.Change,this)},e.prototype.destroy=function(){this.notify(t.ModelEvents.Destroy,this)},e.subclass=t.subclassFactory,e}();t.Model=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){var e=function(){function t(){this.items={},this.size=0}return t.prototype.contains=function(t){var e=t.hash();if(!Object.prototype.hasOwnProperty.call(this.items,e))return!1;var n=this.items[e];if(!Array.isArray(n))return n.equals(t);for(var r=0,o=n.length;r<o;r++)if(n[r].equals(t))return!0;return!1},t.prototype.add=function(t){if(this.contains(t))return!1;var e=t.hash();return Object.prototype.hasOwnProperty.call(this.items,e)?Array.isArray(this.items[e])?this.items[e].push(t):this.items[e]=[this.items[e],t]:this.items[e]=t,this.size++,!0},t.prototype.remove=function(t){if(!this.contains(t))return!1;var e=t.hash();if(Array.isArray(this.items[e])){for(var n=this.items[e],r=0,o=n.length;r<o;r++)if(n[r].equals(t)){n[r]=n[o-1],n.length--;break}}else delete this.items[e];return this.size--,!0},t.prototype.clear=function(){return!(this.size<=0)&&(this.items={},this.size=0,!0)},t.prototype.forEach=function(t,e){for(var n=0,r=Object.keys(this.items),o=0,i=r.length;o<i;o++){var s=this.items[r[o]];if(Array.isArray(s))for(var a=0,u=s.length;a<u;a++)t.call(e,s[a],n),n++;else t.call(e,s,n),n++}},t.prototype.toArray=function(){for(var t=new Array(this.size),e=0,n=Object.keys(this.items),r=0,o=n.length;r<o;r++){var i=this.items[n[r]];if(Array.isArray(i))for(var s=0,a=i.length;s<a;s++)t[e]=i[s],e++;else t[e]=i,e++}return t},t}();t.HashSet=e}(spaMVP||(spaMVP={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},spaMVP;!function(t){t.CollectionEvents={AddedItems:"added-items",DeletedItems:"deleted-items",UpdatedItem:"updated-item"};var e=function(e){function n(){e.call(this),this.models=new t.HashSet}return __extends(n,e),Object.defineProperty(n.prototype,"size",{get:function(){return this.models.size},enumerable:!0,configurable:!0}),n.prototype.equals=function(t){return!1},n.prototype.hash=function(){return 17^this.size},n.prototype.add=function(t){return this.addRange([t])},n.prototype.addRange=function(e){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];this.models.add(i)&&(i.on(t.ModelEvents.Change,this.onItemChange,this),i.on(t.ModelEvents.Destroy,this.onItemDestroy,this),n.push(i))}var s=n.length>0;return s&&this.notify(t.CollectionEvents.AddedItems,n),s},n.prototype.remove=function(t){return this.removeRange([t])},n.prototype.removeRange=function(e){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];this.models.remove(i)&&(i.off(t.ModelEvents.Change,this.onItemChange,this),i.off(t.ModelEvents.Destroy,this.onItemDestroy,this),n.push(i))}var s=n.length>0;return s&&this.notify(t.CollectionEvents.DeletedItems,n),s},n.prototype.clear=function(){return this.removeRange(this.toArray())},n.prototype.contains=function(t){return this.models.contains(t)},n.prototype.any=function(){return this.size>0},n.prototype.toArray=function(){return this.models.toArray()},n.prototype.forEach=function(t,e){this.models.forEach(t,e)},n.prototype.onItemChange=function(e){this.notify(t.CollectionEvents.UpdatedItem,e)},n.prototype.onItemDestroy=function(t){this.removeRange([t])},n.subclass=t.subclassFactory,n}(t.Model);t.Collection=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){function e(t){var e,n,r,o;e=this.events[t],o=e.useCapture,n=e.eventType,r=e.handler,this.removeEventListener(n,r,o),delete this.eventsList[t]}function n(t){var n;if(void 0===t||""===t){for(n in this.eventsList)e.call(this,n);this.eventsList={}}else this.hasEvent(t)&&e.call(this,t);return this.eventsList}function r(t){return"object"==typeof this.eventsList[t]&&this.eventsList[t]}function o(t){var e=this.hasEvent(t);return"function"==typeof e.handler&&e.handler()}function i(t){this.htmlElement=t.htmlElement,this.eventConfig={name:t.name,eventType:t.eventType,handler:void 0!==t.handler&&t.handler,useCapture:void 0!==t.useCapture&&t.useCapture,context:void 0===t.context?null:t.context},this.init()}Element.prototype.trigger=function(){return!1},Element.prototype.hasEvent=function(){return!1},Element.prototype.detach=function(){return!1},Element.prototype.events=!1,t.UIEvent=i,i.prototype.init=function(){if(void 0===this.htmlElement.eventsList)Object.defineProperties(this.htmlElement,{eventsList:{writable:!0,enumerable:!1,configurable:!1,value:{}},events:{enumerable:!1,configurable:!1,get:function(){return this.eventsList},set:function(t){return this.eventsList[t.name]=t}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:o},hasEvent:{writable:!1,enumerable:!1,configurable:!1,value:r},detach:{writable:!1,enumerable:!1,configurable:!1,value:n}});else if(this.htmlElement.hasEvent(this.eventConfig.name))return!1;this.eventConfig.handler=this.eventConfig.handler.bind(this.eventConfig.context||this),this.htmlElement.addEventListener(this.eventConfig.eventType,this.eventConfig.handler,this.eventConfig.useCapture),this.htmlElement.events=this.eventConfig},Object.defineProperties(i.prototype,{detach:{writable:!1,enumerable:!1,configurable:!1,value:function(t){return n.call(this.htmlElement,t)}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:function(t){return o.call(this.htmlElement,t||this.eventConfig.name)}}})}(spaMVP||(spaMVP={}));var spaMVP;!function(t){function e(t){var e=t.target,n=e.dataset;if(n.hasOwnProperty(t.type)){var r=n[t.type];return"function"==typeof this[r]?void this[r](n,e,t):void 0}}var n=function(){function n(t,e){if(!t)throw new Error("Dom node cannot be null.");this._domNode=t,this._template=e}return Object.defineProperty(n.prototype,"domNode",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),n.prototype.map=function(n,r,o){return void 0===r&&(r=!1),new t.UIEvent({name:n,htmlElement:o?this.domNode.querySelector(o):this.domNode,handler:e,eventType:n,context:this,useCapture:r}),this},n.prototype.render=function(t){return this._template&&(this.domNode.innerHTML=this._template.call(this,t)),this.domNode},n.prototype.destroy=function(){return"function"==typeof this.domNode.detach&&this.domNode.detach(),this.removeAllElements(),this._domNode=null,this},n.prototype.query=function(t){return this.domNode.querySelector(t)},n.prototype.removeElement=function(t){var e=this.query(t);return e&&e.parentElement.removeChild(e),this},n.prototype.removeAllElements=function(){for(;this.domNode.firstElementChild;)this.domNode.removeChild(this.domNode.firstElementChild);return this},n.subclass=t.subclassFactory,n}();t.View=n}(spaMVP||(spaMVP={}));var spaMVP;!function(t){var e=function(){function e(){this._view=null,this._model=null,this._modelHandlers={}}return Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(t){this.view!==t&&(this.view&&this.view.destroy(),this._view=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){return this._model},set:function(t){var e=this;this._model!==t&&(Object.keys(this._modelHandlers).forEach(function(n){var r=e._modelHandlers[n];e._model&&e._model.off(n,r,e),t&&t.on(n,r,e)}),this._model=t,this.render())},enumerable:!0,configurable:!0}),e.prototype.onModel=function(t,e){return t&&e&&(this._modelHandlers[t]=e),this},e.prototype.render=function(){return this.view&&this.model?this.view.render(this.model):null},e.prototype.destroy=function(){this.view=null,this.model=null},e.subclass=t.subclassFactory,e}();t.Presenter=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){var e=function(){function t(){this.questionMarkIndex=-1,this.url="",this.tokens=[],this.queryParams=[]}return Object.defineProperty(t.prototype,"value",{get:function(){return this.url},set:function(t){t=t||"",this.url=t,this.questionMarkIndex=t.indexOf("?"),this.queryParams=[],this.tokens=[],this.populateQueryParams(),this.populateTokens()},enumerable:!0,configurable:!0}),t.prototype.anyQueryParams=function(){return this.questionMarkIndex>-1},t.prototype.populateQueryParams=function(){var t=this;this.anyQueryParams()&&(this.queryParams=this.value.substring(this.questionMarkIndex+1).split("&").map(function(e){return t.parseQueryParam(e)}))},t.prototype.parseQueryParam=function(t){var e=t.split("=");return{key:e[0],value:e[1]||""}},t.prototype.populateTokens=function(){var t=this.getValueWithoutQuery();this.tokens=t.split("/").filter(function(t){return""!==t})},t.prototype.getValueWithoutQuery=function(){return this.anyQueryParams()?this.value.substring(0,this.value.length-(this.value.length-this.questionMarkIndex)):this.value},t}();t.UrlHash=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){var e=/{([a-zA-Z]+)}/,n=function(){function t(t,e){if(this.tokens=[],"undefined"==typeof t||"string"!=typeof t||null===t)throw new Error("Route pattern should be non empty string.");this.pattern=t,this.callback=e,this.populateTokens()}return t.prototype.getTokens=function(){return this.tokens.slice(0)},t.prototype.equals=function(t){if(this.tokens.length!==t.tokens.length)return!1;for(var e=0,n=this.tokens.length;e<n;e++){var r=this.tokens[e],o=t.tokens[e];if(!r.isDynamic&&r.name.toLowerCase()!==o.toLowerCase())return!1}return!0},t.prototype.start=function(t){var e=this.getParamsFromUrl(t);this.callback&&this.callback(e)},t.prototype.populateTokens=function(){var t=this;this.tokens=[],this.pattern.split("/").forEach(function(e){""!==e&&t.tokens.push(t.parseToken(e))})},t.prototype.parseToken=function(t){var n=e.exec(t),r=!!n;return{name:r?n[1]:t,isDynamic:r}},t.prototype.getParamsFromUrl=function(t){var e=this.getQueryParamsFromUrl(t);return this.tokens.forEach(function(n,r){n.isDynamic&&(e[n.name]=t.tokens[r])}),e},t.prototype.getQueryParamsFromUrl=function(t){var e={};return t.queryParams.forEach(function(t){return e[t.key]=t.value}),e},t}();t.Route=n}(spaMVP||(spaMVP={}));var spaMVP;!function(t){var e=function(){function e(){this.routes=[],this.urlHash=new t.UrlHash,this.defaultUrl=null}return e.prototype.registerRoute=function(e,n){if(this.routes.some(function(t){return t.pattern===e}))throw new Error("Route "+e+" has been already registered.");this.routes.push(new t.Route(e,n))},e.prototype.startRoute=function(t){this.urlHash.value=t;var e=this.findRoute();return e?void e.start(this.urlHash):void(this.defaultUrl?this.startDefaultRoute(t):console.warn("No route handler for "+t))},e.prototype.getRoutes=function(){return this.routes.map(function(t){return t.pattern})},e.prototype.hasRoutes=function(){return this.routes.length>0},e.prototype.findRoute=function(){for(var t=0,e=this.routes.length;t<e;t++){var n=this.routes[t];if(n.equals(this.urlHash))return n}return null},e.prototype.startDefaultRoute=function(t){window.history.replaceState(null,null,window.location.pathname+"#"+this.defaultUrl),this.urlHash.value=this.defaultUrl;var e=this.findRoute();e?e.start(this.urlHash):console.warn("No route handler for "+t)},e}();t.RouteConfig=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){var e=function(){function t(t,e){if(!t||!e)throw new Error("Missing core or module instance ID");this.core=t,this.moduleInstanceId=e}return t.prototype.subscribe=function(t,e,n){this.core.subscribe(t,e,n)},t.prototype.unsubscribe=function(t,e,n){this.core.unsubscribe(t,e,n)},t.prototype.publish=function(t,e){this.core.publish(t,e)},t.prototype.getService=function(t){return this.core.getService(t)},t}();t.Sandbox=e}(spaMVP||(spaMVP={}));var spaMVP;!function(t){function e(t){var e=this;document.removeEventListener("DOMContentLoaded",this.onDomReady),this.onAppStart&&this.onAppStart(),this.routeConfig.hasRoutes()&&(this.routeConfig.startRoute(window.location.hash.substring(1)),window.addEventListener("hashchange",function(){e.routeConfig.startRoute(window.location.hash.substring(1))}))}function n(t){return new r(t)}var r=function(){function n(n){void 0===n&&(n=new t.RouteConfig),this.onDomReady=e.bind(this),this.subscribers={},this.modules={},this.services={},this.routeConfig=n}return n.prototype.run=function(t){return this.onAppStart=t,document.addEventListener("DOMContentLoaded",this.onDomReady),this},n.prototype.registerRoute=function(t,e){return this.routeConfig.registerRoute(t,e),this},n.prototype.startRoute=function(t){return this.routeConfig.startRoute(t),this},n.prototype.defaultUrl=function(t){return this.routeConfig.defaultUrl=t,this},n.prototype.subscribe=function(t,e,n){if("function"!=typeof e)throw new TypeError("Event type handler should be a function");if(Array.isArray(t))for(var r=0,o=t.length;r<o;r++)this.addSubscriber(t[r],e,n)},n.prototype.unsubscribe=function(t,e,n){if(Array.isArray(t))for(var r=0,o=t.length;r<o;r++)this.removeSubscriber(t[r],e,n)},n.prototype.publish=function(t,e){Array.isArray(this.subscribers[t])&&this.subscribers[t].slice(0).forEach(function(n){return n.handler.call(n.context,t,e)})},n.prototype.register=function(e,n){if(""===e||"string"!=typeof e)throw new TypeError(e+" Module registration FAILED: ID must be a non empty string.");if(this.modules[e])throw new TypeError(e+" Module registration FAILED: a module with such id has been already registered.");var r=n(new t.Sandbox(this,e));if("function"!=typeof r.init||"function"!=typeof r.destroy)throw new TypeError(e+" Module registration FAILED: Module has no init or destroy methods.");return this.modules[e]={create:n,instances:null},this},n.prototype.getAllModules=function(){return Object.keys(this.modules)},n.prototype.start=function(e,n){var r=this.modules[e];if(!r)throw new ReferenceError(e+" Module not found.");if(n=n||{},"object"!=typeof n)throw new TypeError(e+" Module's options must be an object.");r.instances=r.instances||{};var o=n.instanceId||e;if(r.instances.hasOwnProperty(o))return this;var i=r.create(new t.Sandbox(this,o));return r.instances[o]=i,i.init(n),this},n.prototype.stop=function(t,e){var n=this.modules[t],r=e||t;return n&&n.instances&&n.instances.hasOwnProperty(r)&&(n.instances[r].destroy(),delete n.instances[r]),this},n.prototype.addService=function(t,e){if("string"!=typeof t||""===t)throw new TypeError(t+" Service registration FAILED: ID must be non empty string.");if(this.services[t])throw new TypeError(t+" Service registration FAILED: a service with such id has been already added.");return this.services[t]=e,this},n.prototype.getService=function(e){var n=this.services[e];if(!n)throw new ReferenceError(e+" Service was not found.");return n(new t.Sandbox(this,e))},n.prototype.addSubscriber=function(t,e,n){this.subscribers[t]=this.subscribers[t]||[],this.subscribers[t].push({handler:e,context:n})},n.prototype.removeSubscriber=function(t,e,n){for(var r=this.subscribers[t]||[],o=0,i=r.length;o<i;o++){var s=r[o];if(s.handler===e&&s.context===n)return r[o]=r[i-1],void r.length--}},n}();t.Core=r,t.createAppCore=n}(spaMVP||(spaMVP={}));
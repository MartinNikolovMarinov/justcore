var spaMVP=function(n){function t(){this._listeners=null}return t.prototype.on=function(n,t,i){var r,u,f;if(typeof t!="function")throw new Error("Given handler must be a function.");for(this._listeners=this._listeners||{},this._listeners[n]=this._listeners[n]||[],r=this._listeners[n],u=0,f=r.length;u<f;u++)if(r[u].handler===t&&r[u].context===i)return;r.push({handler:t,context:i})},t.prototype.off=function(n,t,i){var r,u,f;if(this._listeners&&this._listeners[n])for(r=this._listeners[n],u=0,f=r.length;u<f;u++)if(r[u].handler===t&&r[u].context===i){r[u]=r[f-1];r.length--;return}},t.prototype.notify=function(n){var i,t,u,r;if(this._listeners&&this._listeners[n.type])for(n.currentTarget=this,i=this._listeners[n.type].slice(0),t=0,u=i.length;t<u;t++)r=i[t],r.handler.call(r.context,n)},t.prototype.destroy=function(){this.notify({type:"destroy"})},n.Model=t,n}(spaMVP||{}),spaMVP=function(n){function i(n){return typeof n.hashCode=="function"?n.hashCode():n.toString()}function r(n,t){return typeof n.equals=="function"?n.equals(t):n===t}function t(n,t){this.items={};this.size=0;this._hashingFunc=n||i;this._equalityFunc=t||r}return t.prototype.add=function(n){if(this.contains(n))return!1;var t=this._hashingFunc(n);return Object.prototype.hasOwnProperty.call(this.items,t)?this.items[t]instanceof Array?this.items[t].push(n):this.items[t]=[this.items[t],n]:this.items[t]=n,this.size++,!0},t.prototype.remove=function(n){var r,t,i,u;if(!this.contains(n))return!1;if(r=this._hashingFunc(n),this.items[r]instanceof Array){for(t=this.items[r],i=0,u=t.length;i<u;i++)if(this._equalityFunc(t[i],n)){t[i]=t[u-1];t.length--;break}}else delete this.items[r];return this.size--,!0},t.prototype.contains=function(n){var r=this._hashingFunc(n),t,i,u;if(!Object.prototype.hasOwnProperty.call(this.items,r))return!1;if(t=this.items[r],!(t instanceof Array))return this._equalityFunc(t,n);for(i=0,u=t.length;i<u;i++)if(this._equalityFunc(t[i],n))return!0;return!1},t.prototype.clear=function(){return this.size<=0?!1:(this.items={},this.size=0,!0)},t.prototype.forEach=function(n){for(var t,r,o,f=arguments[1],i=0,e=Object.keys(this.items),u=0,s=e.length;u<s;u++){if(t=this.items[e[u]],!(t instanceof Array)){n.call(f,t,i);i++;continue}for(r=0,o=t.length;r<o;r++)n.call(f,t[r],i),i++}},t.prototype.toArray=function(){for(var n,i,e,r=new Array(this.size),t=0,f=Object.keys(this.items),u=0,o=f.length;u<o;u++){if(n=this.items[f[u]],!(n instanceof Array)){r[t]=n;t++;continue}for(i=0,e=n.length;i<e;i++)r[t]=n[i],t++}return r},n.HashSet=t,n}(spaMVP||{}),spaMVP=function(n){function t(t,i){n.Model.call(this);this.models=new n.HashSet(t,i)}return t.prototype=Object.create(n.Model.prototype),t.prototype.constructor=t,t.prototype.add=function(n){return this.addRange([n])},t.prototype.addRange=function(t){for(var i,f,r=[],u=0,e=t.length;u<e;u++){if(i=t[u],!(i instanceof n.Model))throw new ReferenceError("Item must be a subclass of spaMVP.Model.js");if(this.models.add(i)){i.on("change",this.onItemChange,this);i.on("destroy",this.onItemDestroy,this);r.push(i)}}return f=r.length>0,f&&this.notify({type:"change",addedTargets:r,deletedTargets:[],updatedTargets:[]}),f},t.prototype.remove=function(n){return this.removeRange([n])},t.prototype.removeRange=function(n){for(var t,u,i=[],r=0,f=n.length;r<f;r++)(t=n[r],this.models.remove(t))&&(t.off("change",this.onItemChange,this),t.off("destroy",this.onItemDestroy,this),i.push(t));return u=i.length>0,u&&this.notify({type:"change",addedTargets:[],deletedTargets:i,updatedTargets:[]}),u},t.prototype.clear=function(){var n=this.toArray();return this.removeRange(n)},t.prototype.contains=function(n){return this.models.contains(n)},t.prototype.any=function(){return this.models.size>0},t.prototype.toArray=function(){return this.models.toArray()},t.prototype.forEach=function(n){var t=arguments[1];this.models.forEach(n,t)},t.prototype.onItemChange=function(n){this.notify({type:"change",addedTargets:[],deletedTargets:[],updatedTargets:[n.currentTarget]})},t.prototype.onItemDestroy=function(n){this.remove(n.currentTarget)},n.Collection=t,n}(spaMVP),spaMVP=function(n){var t=function(){function t(n){var t,i,r,u;t=this.events[n];u=t.useCapture;i=t.eventType;r=t.handler;this.removeEventListener(i,r,u);delete this.eventsList[n]}function i(n){var i;if(n===undefined||n===""){for(i in this.eventsList)t.call(this,i);this.eventsList={}}else this.hasEvent(n)&&t.call(this,n);return this.eventsList}function u(n){return typeof this.eventsList[n]=="object"?this.eventsList[n]:!1}function r(n){var t=this.hasEvent(n);return typeof t.handler=="function"?t.handler():!1}function n(t){if(!t)return!1;if(this instanceof n==!1)return new n(t);this.htmlElement=t.htmlElement;this.eventConfig={name:t.name,eventType:t.eventType,handler:t.handler===undefined?!1:t.handler,useCapture:t.useCapture===undefined?!1:t.useCapture,context:t.context===undefined?null:t.context};this.init()}return Element.prototype.trigger=function(){return!1},Element.prototype.hasEvent=function(){return!1},Element.prototype.detach=function(){return!1},Element.prototype.events=!1,n.prototype.init=function(){if(this.htmlElement.eventsList===undefined)Object.defineProperties(this.htmlElement,{eventsList:{writable:!0,enumerable:!1,configurable:!1,value:{}},events:{enumerable:!1,configurable:!1,get:function(){return this.eventsList},set:function(n){return this.eventsList[n.name]=n}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:r},hasEvent:{writable:!1,enumerable:!1,configurable:!1,value:u},detach:{writable:!1,enumerable:!1,configurable:!1,value:i}});else if(this.htmlElement.hasEvent(this.eventConfig.name))return!1;this.eventConfig.handler=this.eventConfig.handler.bind(this.eventConfig.context||this);this.htmlElement.addEventListener(this.eventConfig.eventType,this.eventConfig.handler,this.eventConfig.useCapture);this.htmlElement.events=this.eventConfig},Object.defineProperties(n.prototype,{detach:{writable:!1,enumerable:!1,configurable:!1,value:function(n){return i.call(this.htmlElement,n)}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:function(n){return r.call(this.htmlElement,n||this.eventConfig.name)}}}),n}();return n._private=n._private||{},n._private.UIEvent=t,n}(spaMVP||{}),spaMVP=function(n,t){function u(){for(var n,i=this.mapEvents(),t=0,u=i.length;t<u;t++)n=i[t],new r.UIEvent({name:"on"+this._id+n.type,htmlElement:this.domNode,handler:f,eventType:n.type,context:this,useCapture:n.useCapture||!1})}function f(n){var r=n.target||n.srcElement,t=r.dataset,i=null;if(t.hasOwnProperty(n.type)&&(i=t[n.type],typeof this[i]=="function")){this[i](t,r,n);return}}function i(n,i){this._presenter=null;this._template=i||null;this._id=n;this.domNode=t.querySelector(n)}var r=n._private;return i.prototype.render=function(n){return this.domNode&&this._template&&(this.domNode.innerHTML=this._template.call(this,n)),this.domNode},i.prototype.getPresenter=function(){return this._presenter},i.prototype.setPresenter=function(n){return this._presenter===n?this:(this._presenter=n,u.call(this),this)},i.prototype.mapEvents=function(){return[]},i.prototype.findElement=function(n){return this.domNode.querySelector(n)},i.prototype.removeElement=function(n){var t=this.domNode.querySelector(n);return t&&t.parentElement.removeChild(t),this},i.prototype.removeAllElements=function(){while(this.domNode.firstElementChild)this.domNode.removeChild(this.domNode.firstElementChild);return this},i.prototype.insertElementAt=function(n,t){return this.domNode.insertBefore(t,this.domNode.children[n]),this},i.prototype.destroy=function(){this.domNode&&(typeof this.domNode.detach=="function"&&this.domNode.detach(),this.removeAllElements(),this.domNode=null)},n.View=i,n}(spaMVP||{},document),spaMVP=function(n){function t(t){if(!(t instanceof n.View))throw new Error("Given view must be a subclass of View.js");this._view=null;this._model=null;this.setView(t)}return t.prototype.getView=function(){return this._view},t.prototype.setView=function(n){this._view!==n&&(this._view&&this._view.destroy(),n&&n.setPresenter(this),this._view=n)},t.prototype.getModel=function(){return this._model},t.prototype.setModel=function(t){var r=null,u=null,i;if(t&&!(t instanceof n.Model))throw new Error("Model must be a subclass of spaMVP.Model");if(this._model!==t){r=this.getModelEventsMap();for(i in r)if(u=r[i],this._model&&this._model.off(i,this[u],this),t)t.on(i,this[u],this);this._model=t;this._model&&this.render()}},t.prototype.render=function(){return this.getView().render(this.getModel())},t.prototype.getModelEventsMap=function(){return{change:"onModelChange",destroy:"onModelDestroy"}},t.prototype.onModelChange=function(){},t.prototype.onModelDestroy=function(){this.destroy()},t.prototype.destroy=function(){this.setView(null);this.setModel(null)},n.Presenter=t,n}(spaMVP),spaMVP=function(n){function h(){o=/{([a-zA-Z]+)}/;i=[];f=new u;window.addEventListener("hashchange",c)}function c(){f.startRoute(window.location.hash.substring(1))}function l(n){for(var r,t=0,u=i.length;t<u;t++)if(r=i[t],r.equals(n))return r;return null}function t(){}function r(n,t){this.pattern=n;this.callback=t;this.tokens=[];this.extractTokens()}function u(){this.defaultUrl=null}var f=null,o=null,i=null,e=null,s;return t.create=function(n){return e||(e=new t),e.init(n),e},t.prototype.init=function(n){this.value=n;this.questionMarkIndex=n.indexOf("?");this.queryParams=[];this.tokens=[];this.extractQueryParams();this.extractTokens()},t.prototype.extractQueryParams=function(){var n=this.questionMarkIndex>-1;n&&(this.queryParams=this.value.substring(this.questionMarkIndex+1).split("&").map(function(n){return this.getQueryParamFromString(n)},this))},t.prototype.getQueryParamFromString=function(n){return n=n.split("="),{key:n[0],value:n[1]}},t.prototype.extractTokens=function(){if(this.removeQueryString(),this.value===""||this.value==="/"){this.tokens=["/"];return}this.tokens=this.value.split("/").map(function(n){return this.parseToken(n)},this)},t.prototype.removeQueryString=function(){var n=this.questionMarkIndex>-1;n&&(this.value=this.value.substring(0,this.value.length-(this.value.length-this.questionMarkIndex)))},t.prototype.parseToken=function(n){return n||"/"},r.prototype.extractTokens=function(){if(this.pattern==="/"||this.pattern===""){this.tokens=["/"];return}this.tokens=this.pattern.split("/").map(function(n){return this.parseToken(n)},this)},r.prototype.parseToken=function(n){var t=o.exec(n);return t?{name:t[1]}:n||"/"},r.prototype.equals=function(n){var t,i;if(this.tokens.length!==n.tokens.length)return!1;for(t=0,i=this.tokens.length;t<i;t++){var r=this.tokens[t],u=n.tokens[t],f=typeof r=="object";if(!f&&r.toLowerCase()!==u.toLowerCase())return!1}return!0},r.prototype.getParamsFromUrl=function(n){if(this.tokens.length!==n.tokens.length)throw new Error("Url does not match the target route.");var t=this.getQueryParamsFromUrl(n);return this.tokens.forEach(function(i,r){var u=typeof i=="object";u&&(t[i.name]=n.tokens[r])}),t},r.prototype.getQueryParamsFromUrl=function(n){var t={};return n.queryParams.forEach(function(n){t[n.key]=n.value}),t},r.prototype.start=function(n){this.callback(n)},u.prototype.registerRoute=function(n,t){if(typeof n!="string")throw new Error("Route pattern must be a string");if(typeof t!="function")throw new Error("Route callback must be function");i.push(new r(n,t))},u.prototype.setDefaultUrl=function(n){if(typeof n!="string")throw new Error("url must be a string.");this.defaultUrl=n},u.prototype.startRoute=function(n){var r=t.create(n),i=l(r),u;if(i){u=i.getParamsFromUrl(r);i.start(u);return}this.startDefaultRoute()},u.prototype.startDefaultRoute=function(){this.defaultUrl&&(window.history.replaceState(null,null,window.location.pathname+"#"+this.defaultUrl),this.startRoute(this.defaultUrl))},u.prototype.getRoutes=function(){return i.map(function(n){return n.pattern})},s={getInstance:function(){return f||h(),f},hasRoutes:function(){return!!i&&i.length>0}},n._private=n._private||{},n._private.RouteManager=s,n}(spaMVP||{}),spaMVP=function(n){function t(n){var t=n();if(!t||typeof t!="function")throw new Error("Inheritor's function constructor must be supplied.");return i.call(this,t)}function i(n){var i=this,u=n.prototype;return n.prototype=Object.create(i.prototype),r(n.prototype,u),n.prototype.constructor=n,n.BaseClass=i,n.subclass=t,n}function r(n,t){for(var i in t)t[i]&&(n[i]=t[i])}return typeof Object.create!="function"&&(Object.create=function(n){function t(){}return t.prototype=n,new t}),n._private=n._private||{},n._private.subclassFactoryMethod=t,n}(spaMVP||{}),spaMVP=function(n){function t(n,t){this.core=n;this.moduleInstanceId=t}return t.prototype.publish=function(n,t){typeof n=="string"&&this.core.publish(n,t)},t.prototype.subscribe=function(n,t,i){if(!Array.isArray(n))throw new TypeError("Event types must be an array");if(typeof t!="function")throw new TypeError("Event type handler must be a function");this.core.subscribe(n,t,i)},t.prototype.unsubscribe=function(n,t,i){Array.isArray(n)&&this.core.unsubscribe(n,t,i)},t.prototype.getService=function(n){return this.core.getService(n)},n.Sandbox=t,n}(spaMVP||{}),spaMVP=function(n){"use strict";function o(){document.removeEventListener("DOMContentLoaded",o);f();r.RouteManager.hasRoutes()&&r.RouteManager.getInstance().startRoute(window.location.hash.substring(1))}function s(n,t,r){i[n]=i[n]||[];i[n].push({handler:t,context:r})}function h(n,t,r){for(var e,u=i[n]||[],f=0,o=u.length;f<o;f++)if(e=u[f],e.handler===t&&e.context===r){u[f]=u[o-1];u.length--;return}}function t(){}var r=n._private,f=function(){},i={},u={},e={};return t.prototype.run=function(n){return f=typeof n=="function"?n.bind(this):f.bind(this),document.addEventListener("DOMContentLoaded",o),this},t.prototype.registerRoute=function(n,t){return r.RouteManager.getInstance().registerRoute(n,t.bind(this)),this},t.prototype.startRoute=function(n){return r.RouteManager.getInstance().startRoute(n),this},t.prototype.defaultUrl=function(n){return r.RouteManager.getInstance().setDefaultUrl(n),this},t.prototype.subscribe=function(n,t,i){for(var r=0,u=n.length;r<u;r++)s(n[r],t,i)},t.prototype.unsubscribe=function(n,t,i){for(var r=0,u=n.length;r<u;r++)h(n[r],t,i)},t.prototype.publish=function(n,t){var u,r,e,f;if(Array.isArray(i[n]))for(u=i[n].slice(0),r=0,e=u.length;r<e;r++)f=u[r],f.handler.call(f.context,n,t)},t.prototype.register=function(t,i){var r=null;if(typeof t!="string"||t==="")throw new TypeError(t+" Module registration FAILED: ID must be a non empty string.");if(typeof i!="function")throw new TypeError(t+" Module registration FAILED: moduleFactory must be a function which provides a module.");if(u[t])throw new TypeError(t+" Module registration FAILED: a module with such id has been already registered.");if(r=i(new n.Sandbox(this,t)),typeof r.init!="function"||typeof r.destroy!="function")throw new TypeError(t+" Module registration FAILED: Module has no init or destroy methods.");return r=null,u[t]={create:i,instances:null},this},t.prototype.start=function(t,i){var r=u[t],f,e;if(!r)throw new ReferenceError(t+" Module not found.");if(i=i||{},typeof i!="object")throw new TypeError(t+" Module's options must be an object.");return(r.instances=r.instances||{},f=i.instanceId||t,r.instances.hasOwnProperty(f))?this:(e=r.create(new n.Sandbox(this,f)),r.instances[f]=e,e.init(i),this)},t.prototype.stop=function(n,t){var i=u[n],r=t||n;return i&&i.instances&&i.instances.hasOwnProperty(r)&&(i.instances[r].destroy(),delete i.instances[r]),this},t.prototype.addService=function(n,t){if(typeof n!="string"||n.trim()==="")throw new TypeError(n+" Service registration FAILED: ID must be non empty string.");if(typeof t!="function")throw new TypeError(n+" Service registration FAILED: factory must be a function which provides a service.");if(e[n])throw new TypeError(n+" Service registration FAILED: a service with such id has been already added.");return e[n]={create:t},this},t.prototype.getService=function(t){var i=e[t];if(!i)throw new ReferenceError(t+" Service was not found.");return i.create(new n.Sandbox(this))},n._private=n._private||{},n._private.Core=t,n}(spaMVP||{}),spaMVP=function(n){"use strict";var t=n._private;return n.Model.subclass=n.View.subclass=n.Presenter.subclass=n.Collection.subclass=t.subclassFactoryMethod,n.createAppCore=function(){return new t.Core},delete n._private,n}(spaMVP);